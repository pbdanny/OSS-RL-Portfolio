---
output: 
  html_document:
    keep_md: true
---

# OSS RL Aug-Sep 2017 analysis on D36

```{r adjust_directory_if_needed, include=FALSE}
# Initialise Project
# Uncomment lines below if rmd file is placed in a subdirectory
# library(knitr)
# opts_knit$set(root.dir = normalizePath('../')) 
```

```{r load_project, include=FALSE}
# 1. Set options in config/global.dcf
# 2. Load packages listed in config/global.dcf
# 3. Import functions and coe in lib directory
# 4. Load data in data directory
# 5. Run data manipulations in munge directory 

rm(list = ls()) # optionally refresh workspace
library(ProjectTemplate); load.project()
```             

### Key number summary
```{r table_summary_result, echo=FALSE}

library(kableExtra)

rl_os %>%
    group_by(month) %>%
    summarise(finalize = n(), appr = sum(appr), 
              loansize_amt = sum(approve_amount), fdd_amt = sum(fdd)) %>%
    gather(key = kpi, value = value, -month) %>%
    spread(key = month, value = value) %>%
    mutate(kpi = factor(kpi, levels = c('finalize', 'appr', 
                                        'loansize_amt', 'fdd_amt'))) %>%
    arrange(kpi) %>%
    kable(format = 'html', digits = 2,
          format.args = list(decimal.mark = ".", big.mark = ",")) %>%
    kable_styling(bootstrap_options = c("striped", "hover"),
                  full_width = FALSE, position = 'left')

```
## Key Kpi by Month

### Approved Performance

% Approval rate
Avg Loansize
Avg FDD
% Early 60D

### Finalized Performance
Top Reject Reason
Top Decline Reason
Customer income range table
Customer income density
Customer age range table
Customer age density
Customer region table 
Customer region map

# Explore
Plot age distribution D36 vs others D

```{r simpleplot, echo=FALSE}
rl_os %>%
        filter(result == 'D') %>%
        mutate(D_group = ifelse(result_description == 'D36', 'D36', 'Oth-D')) %>%
        ggplot(aes(x = age, color = D_group)) +
        geom_density() +
        ggtitle("D36 vs Other-D Age Distribution")
```
